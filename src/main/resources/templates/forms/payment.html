<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:http="http://www.w3.org/1999/xhtml">
<head th:replace="fragments/header :: header('Payment')"></head>

<body>
<div th:replace="fragments/navbar :: navbar"></div>

<!-- Button trigger modal -->
<button type="button" id="buy" class="btn btn-primary">
    Buy Me
</button>
<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Payment Title</h5>
            </div>
            <div class="modal-body">
                <!--form for payment entry-->
                <form action="http://requestb.in/12vf5wd1" method="POST" id="payment-form">
                    <span class="payment-errors"></span>

                    <div class="row">
                        <label>
                            <span>Card Number</span>
                            <input type="text" data-stripe="number" />
                        </label>
                    </div>

                    <div class="row">
                        <label>
                            <span>CVC</span>
                            <input type="text" data-stripe="cvc" />
                        </label>
                    </div>

                    <div class="row">
                        <label>
                            <span>Expiration (MM/YYYY)</span>
                            <input type="text" data-stripe="exp-month" />
                        </label>
                        <input type="text" data-stripe="exp-year" />
                    </div>

                    <button type="submit">Buy Now</button>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<a
    class="btn btn-primary"
    href="https://connect.stripe.com/oauth/authorize?response_type=code&amp;client_id=ca_AAoE51ADyJNRUZfkhjed88sHXNfP79F3&amp;scope=read_write"
>
    Stripe
</a>
<script type="text/javascript" src="https://js.stripe.com/v2/"></script>
<script
    src="https://code.jquery.com/jquery-3.1.1.min.js"
    integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
    crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script>
    "use strict";

//    Stripe.apiKey = "sk_test_kUyFKcQWcsRYKDohJ6bPDm3F";
//    Stripe.apiVersion = "2017-02-14";

    (function() {

        $('#buy').on("click",function (e) {
            e.preventDefault();
            $('#myModal').modal('show');
            return false;
        });

        Stripe.setPublishableKey('pk_test_JKbmxAoOv4rgoznSpQ9RMgjF');
//        Stripe.setPublishableKey(Stripe.apiKey);


    // Event Listeners
    $('#payment-form').on('submit', generateToken);

    var generateToken = function(e) {
        var form = $(this);

        // No pressing the buy now button more than once
        form.find('button').prop('disabled', true);

        // Create the token, based on the form object
        Stripe.create(form, stripeResponseHandler);

        // Prevent the form from submitting
        e.preventDefault();
    };

    var stripeResponseHandler = function(status, response) {
        var $form = $('#payment-form');

        // Any validation errors?
        if (response.error) {
            // Show the user what they did wrong
            $form.find('.payment-errors').text(response.error.message);

            // Make the submit clickable again
            $form.find('button').prop('disabled', false);
        } else {
            // Otherwise, we're good to go! Submit the form.

            // Insert the unique token into the form
            $('<input />', {
                'type': 'hidden',
                'name': 'stripeToken',
                'value': response.id
            }).appendTo(form);

            // Call the native submit method on the form
            // to keep the submission from being canceled
            $form.get(0).submit();
        }
    };
    })();
</script>

<div th:replace="fragments/footer :: footer"></div>
</body>
</html>